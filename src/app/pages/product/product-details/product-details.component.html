<div [innerHTML]="jsonLd"></div>

<div class="details">
  <ng-container *ngFor="let entry of indices | keyvalue: keyValuePipeComparator" [ngSwitch]="entry.value">

    <div class="details__title"
         [class.details__title--active]="activeIdx === entry.value"
         (click)="toggleContent(entry.value)"
    >
      <ng-container *ngSwitchCase="indices.description">Описание</ng-container>
      <ng-container *ngSwitchCase="indices.chars">Характеристики</ng-container>
      <ng-container *ngSwitchCase="indices.reviews">
        Отзывы
        <span class="details__reviews-count" *ngIf="product.reviewsCount > 0">({{ product.reviewsCount }})</span>
      </ng-container>

      <i class="mbi mbi-chevron-down details__title-icon"
         [class.details__title-icon--active]="activeIdx === entry.value"
      ></i>
    </div>

    <div class="details__content" [class.details__content--visible]="activeIdx === entry.value">

      <ng-container *ngSwitchCase="indices.description" [ngTemplateOutlet]="descTmpl"></ng-container>
      <ng-container *ngSwitchCase="indices.chars" [ngTemplateOutlet]="charsTmpl"></ng-container>
      <ng-container *ngSwitchCase="indices.reviews" [ngTemplateOutlet]="reviewsTmpl"></ng-container>

    </div>

  </ng-container>
</div>


<ng-template #descTmpl>
  <div class="description html-description" [innerHTML]="product.safeFullDescription"></div>
</ng-template>

<ng-template #charsTmpl>
  <div class="chars">
    <div class="chars__item" *ngFor="let char of product.characteristics, first as first">
      <div class="chars__cell chars__label" [class.chars__cell--first]="first">{{ char.label }}</div>
      <div class="chars__cell chars__value" [class.chars__cell--first]="first">{{ char.value }}</div>
    </div>
  </div>
</ng-template>

<ng-template #reviewsTmpl>
  <div class="reviews">

    <div class="reviews__add">
      Оставьте свой отзыв об этом товаре

      <button class="reviews__add-btn" (click)="openReviewModal()" type="button">Написать отзыв</button>
    </div>

    <review class="reviews__review"
            *ngFor="let review of reviews"
            [review]="review"
            (vote)="vote(review)"
            (downvote)="downvote(review)"
            (addComment)="onAddComment(review, $event)"
    ></review>
  </div>
</ng-template>

<add-review-modal [uploadUrl]="mediaUploadUrl" (addReview)="onReviewAdd($event)"></add-review-modal>
